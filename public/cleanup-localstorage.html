<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpeza do LocalStorage - Gang Boyz</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #fff;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff0000, #800080, #0000ff);
            border-radius: 10px;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        button {
            background: linear-gradient(135deg, #ff0000, #800080);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            opacity: 0.9;
        }
        .log {
            background-color: #1e1e1e;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background-color: #2d5a2d;
            border: 1px solid #4caf50;
        }
        .warning {
            background-color: #5a4a2d;
            border: 1px solid #ff9800;
        }
        .error {
            background-color: #5a2d2d;
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üßπ Limpeza do LocalStorage</h1>
        <p>Gang Boyz E-commerce</p>
    </div>

    <div class="container">
        <h2>Status do LocalStorage</h2>
        <div id="status" class="status">
            <p>Aguardando an√°lise...</p>
        </div>
        <button onclick="checkUsage()">üîç Verificar Uso</button>
        <button onclick="cleanupData()">üßπ Limpar Dados Antigos</button>
        <button onclick="showDetails()">üìã Mostrar Detalhes</button>
    </div>

    <div class="container">
        <h2>Log de Execu√ß√£o</h2>
        <div id="log" class="log"></div>
    </div>

    <script>
        // Fun√ß√£o para adicionar log
        function addLog(message, type = '') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            if (type) {
                logEntry.className = type;
            }
            
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Fun√ß√£o para verificar o uso do localStorage
        function checkUsage() {
            try {
                if (typeof localStorage === 'undefined') {
                    addLog('localStorage n√£o dispon√≠vel', 'error');
                    return;
                }

                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length + key.length;
                    }
                }

                const totalMB = (total / 1024 / 1024).toFixed(2);
                const percentage = (total / (5 * 1024 * 1024)) * 100;
                
                const statusElement = document.getElementById('status');
                statusElement.innerHTML = `
                    <p><strong>Uso atual:</strong> ${totalMB}MB / 5MB</p>
                    <p><strong>Percentual:</strong> ${percentage.toFixed(1)}%</p>
                `;
                
                if (percentage > 80) {
                    statusElement.className = 'status warning';
                    addLog(`‚ö†Ô∏è Uso elevado: ${percentage.toFixed(1)}%`, 'warning');
                } else if (percentage > 95) {
                    statusElement.className = 'status error';
                    addLog(`‚ùå Uso cr√≠tico: ${percentage.toFixed(1)}%`, 'error');
                } else {
                    statusElement.className = 'status success';
                    addLog(`‚úÖ Uso normal: ${percentage.toFixed(1)}%`, 'success');
                }
                
                addLog(`üìä LocalStorage: ${totalMB}MB / 5MB (${percentage.toFixed(1)}%)`);
            } catch (error) {
                addLog(`‚ùå Erro ao verificar uso: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para limpar dados antigos
        function cleanupData() {
            try {
                if (typeof localStorage === 'undefined') {
                    addLog('localStorage n√£o dispon√≠vel', 'error');
                    return;
                }

                addLog('üîç Iniciando limpeza de dados antigos...');
                
                const keysToKeep = [
                    'gang-boyz-active-theme',
                    'gang-boyz-about-info',
                    'gang-boyz-test-products',
                    'gang-boyz-products',
                    'gang-boyz-recommendations',
                    'gang-boyz-editable-contents',
                    'gang-boyz-user-preferences'
                ];

                // Limpar dados duplicados ou muito antigos no gang-boyz-test-products
                const testProducts = localStorage.getItem('gang-boyz-test-products');
                if (testProducts) {
                    try {
                        const products = JSON.parse(testProducts);
                        addLog(`üõçÔ∏è Produtos no admin: ${products.length}`);
                        
                        // Manter apenas os √∫ltimos 50 produtos
                        if (products.length > 50) {
                            const recentProducts = products.slice(-50);
                            localStorage.setItem('gang-boyz-test-products', JSON.stringify(recentProducts));
                            addLog(`‚úÇÔ∏è Reduzido de ${products.length} para 50 produtos`, 'success');
                        }
                    } catch (error) {
                        addLog(`‚ùå Erro ao limpar produtos: ${error.message}`, 'error');
                        localStorage.removeItem('gang-boyz-test-products');
                    }
                }

                // Limpar dados duplicados ou muito antigos no gang-boyz-recommendations
                const recommendations = localStorage.getItem('gang-boyz-recommendations');
                if (recommendations) {
                    try {
                        const recs = JSON.parse(recommendations);
                        addLog(`‚≠ê Recomenda√ß√µes: ${recs.length}`);
                        
                        // Manter apenas os √∫ltimos 30 recomenda√ß√µes
                        if (recs.length > 30) {
                            const recentRecs = recs.slice(-30);
                            localStorage.setItem('gang-boyz-recommendations', JSON.stringify(recentRecs));
                            addLog(`‚úÇÔ∏è Reduzido de ${recs.length} para 30 recomenda√ß√µes`, 'success');
                        }
                    } catch (error) {
                        addLog(`‚ùå Erro ao limpar recomenda√ß√µes: ${error.message}`, 'error');
                        localStorage.removeItem('gang-boyz-recommendations');
                    }
                }

                addLog('‚úÖ Limpeza conclu√≠da!', 'success');
                checkUsage(); // Atualizar status ap√≥s limpeza
            } catch (error) {
                addLog(`‚ùå Erro durante limpeza: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para mostrar detalhes do uso
        function showDetails() {
            try {
                if (typeof localStorage === 'undefined') {
                    addLog('localStorage n√£o dispon√≠vel', 'error');
                    return;
                }

                addLog('\nüìã Detalhes do LocalStorage:');
                addLog('==========================');

                const gangBoyzKeys = Object.keys(localStorage).filter(key => key.startsWith('gang-boyz-'));
                
                gangBoyzKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    const size = (value.length / 1024).toFixed(2);
                    addLog(`  ${key}: ${size}KB`);
                });

                addLog(`\nüì¶ Total de chaves do Gang Boyz: ${gangBoyzKeys.length}`);
            } catch (error) {
                addLog(`‚ùå Erro ao mostrar detalhes: ${error.message}`, 'error');
            }
        }

        // Inicializar
        window.onload = function() {
            addLog('üöÄ Painel de Limpeza do LocalStorage iniciado');
            checkUsage();
        };
    </script>
</body>
</html>